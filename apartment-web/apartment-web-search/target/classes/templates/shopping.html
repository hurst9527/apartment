<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <!-- site metas -->
    <title>公寓商城</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- site icon -->
    <link th:href="@{images/fevicon.png}" rel="icon" type="image/png}"/>
    <!-- bootstrap css -->
    <link rel="stylesheet" th:href="@{css/bootstrap.min.css}"/>
    <!-- site css -->
    <link rel="stylesheet" th:href="@{css/style.css}"/>
    <!-- responsive css -->
    <link rel="stylesheet" th:href="@{css/responsive.css}"/>
    <!-- color css -->
    <link rel="stylesheet" th:href="@{css/colors.css}"/>
    <!-- select bootstrap -->
    <link rel="stylesheet" th:href="@{css/bootstrap-select.css}"/>
    <!-- scrollbar css -->
    <link rel="stylesheet" th:href="@{css/perfect-scrollbar.css}"/>
    <!-- custom css -->
    <link rel="stylesheet" th:href="@{css/custom.css}"/>
    <!-- calendar file css -->
    <link rel="stylesheet" th:href="@{css/semantic.min.css}"/>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
          integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css"
          integrity="sha384-6pzBo3FDv/PJ8r2KRkGHifhEocL+1X2rVCTTkUfGk7/0pbek5mMa1upzvWbrUbOZ" crossorigin="anonymous">
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <!--    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"-->
    <!--            integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous">-->
    <!--    </script>-->
    <style>
        #specChoseDiv {
            margin-top: 10px;
            border-width: 1px;
            border-style: double;
            border-color: grey;
            font-size: small;
            overflow: hidden;
        }

        .col-xs-6 {
            padding: 0 5px;
        }

        #specChoseDiv .row .title {
            margin-top: 3px;
            float: right;
        }

        #specChoseDiv .Item {
            border-top: 1px solid grey;
        }

        #specChoseDiv .row .specItem {
            margin-left: 0px;
            margin-right: 7px;
        }


        #specChoseDiv .row .titleDiv {
            background-color: rgb(180, 220, 221);
        }

        #specChoseDiv .row .logo-list li {
            margin-top: 3px;
            width: 70px;
            height: 33px;
            line-height: 33px;
            text-align: center;
            border: 1px solid grey;
        }

        #specChoseDiv .row .logo-list li a {
            color: rgb(97, 99, 100);
            font-weight: 800;
        }

        .cateList {
            padding-top: 2px;
            padding-bottom: 2px;
        }

        .cateList .row {
            padding-left: 20px;
        }

        .goodCount {
            margin-left: 7px;
            margin-top: 7px;
        }

        .goodDetail {
            z-index: 9999999999;
            background-color: white;
            height: 600px;
            position: fixed;
            bottom: -600px;
            width: 98%;
            margin-left: 1%;
        }


        .closeGoodDetail {
            border-radius: 50%;
            border: black 1px solid;
            width: 25px;
            height: 25px;
            line-height: 25px;
            display: inline-block;
            text-align: center;
            position: absolute;
            right: 13px;
            top: 7px;
        }

        .goodTitle {
            margin-left: 1%;
            text-align: center;
            display: block;
            font-weight: 600;
            font-size: 19px;
            padding-top: 5px;
        }

        .goodImg {
            padding-top: 20px;
            padding-left: 20px;
        }

        .goodImg img {
            width: 90px;
            height: 90px;
            border-radius: 5px;
        }

        .goodDetailSpecs {
            height: 320px;
            overflow: auto;
        }

        .goodDetailSpec {
            padding-left: 10px;
        }

        .goodDetailSpecItem {
            padding-left: 15px;
        }

        .goodDetailSpecTitle {
            font-size: 18px;
            font-weight: 450;
        }

        .goodDetailSpecItem span {
            border: 1px solid gray;
            padding: 1px 5px;
            border-radius: 7px;
            background-color: rgb(245, 245, 245);
            color: black;
            font-size: 16px;
            margin: 5px;
        }

        .goodDetailSpecItem i {
            font-style: normal;
        }

        .goodDetailSpecItem img {
            height: 20px;
            width: 20px;
            border-radius: 3px;
            margin-bottom: 2px;
        }

        .choseItem span {
            border: 2px solid rgb(233, 74, 17);
        }

        .priceUnit {
            font-size: 15px;
            font-weight: 550;
            color: rgb(233, 74, 17);
        }

        .price {
            font-size: 20px;
            font-weight: 550;
            color: rgb(233, 74, 17);
        }

        .buyNum {
            height: 40px;
            line-height: 40px;
            padding-left: 10px;
            border-top: 1px solid darkgrey;
            font-size: large;
            font-weight: 550;
            position: absolute;
            width: 100%;
        }

        .buyNumChange {
            position: absolute;
            right: 20px;
        }

        .buyNumDes, .buyNumPlus {
            width: 34px;
            height: 34px;
            display: inline-block;
            vertical-align: middle;
            text-align: center;

        }

        .buyNumDes {
            background-color: rgb(248, 248, 248);
            line-height: 30px;
        }

        .buyNumPlus {
            background-color: rgb(241, 241, 241);
            line-height: 35px;
        }

        .buyNumInput {
            width: 34px;
            height: 34px;
            background-color: rgb(241, 241, 241);
            border: none;
            text-align: center;
            line-height: 32px;
        }

        .buyNow {
            background-color: rgb(236, 93, 42);
            margin: 0 auto;
            position: absolute;
            bottom: 7px;
            width: 98%;
            border-radius: 15px;
            height: 38px;
            text-align: center;
            line-height: 38px;
            color: white;
            font-weight: 550;
        }
    </style>
</head>

<body class="inner_page contact_page">
<div class="full_container">
    <div class="goodDetail">
         <span class="goodTitle">
            商品详情
         </span>
        <span class="closeGoodDetail">X</span>
        <div class="goodImg">
            <span><img alt="" th:src="@{images/loader/loading.gif}" id="skuImg"></span>
            <span class="priceUnit">￥</span>
            <span class="price" id="price">--</span>
        </div>
        <hr style="color: darkgrey;">
        <div class="goodDetailSpecs">
            <div class="goodDetailSpec">
                <div class="goodDetailSpecTitle">
                    参数名：
                </div>
                <div class="goodDetailSpecItem">
                    <span><i>银色</i></span>
                </div>
            </div>
        </div>
        <div class="buyNum">
            <span>购买数量
               <span class="buyNumChange">
                  <span class="buyNumDes">-</span>
                  <input class="buyNumInput" type="text">
                  <span class="buyNumPlus">+</span>
               </span>
            </span>
        </div>
        <div class="buyNow" id="buyNow">立即购买</div>
    </div>

    <div class="inner_container">
        <!-- right content -->
        <div id="content" style="padding-left: 25px">
            <!-- topbar -->
            <div class="topbar" style="padding: 0">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <div class="full">
                        <div class="logo_section">
                            <a href="index.html"><img class="img-responsive" th:src="@{images/logo/logo.png}" alt="#"/></a>
                        </div>
                        <div class="right_topbar" style="height: 50px;">
                            <div class="icon_info">
                                <a class="btn btn-primary" role="button"
                                   style="position: relative; top: 50%; transform: translateY(25%);margin-right: 25px;color: white" id="myOrders">
                                    <i class="fa fa-shopping-cart"></i>&nbsp;&nbsp;我的订单</a>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
            <!-- end topbar -->
            <!-- 搜索框 -->

            <div class="row">
                <div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
                </div>
                <div class="col-xs-10 col-sm-10 col-md-10 col-lg-10">
                    <div class="icon_info">
                        <form action="shopping" class="navbar-form navbar-left" method="get" role="search">
                            <div class="row">
                                <div class="col-xs-9 col-sm-9 col-md-9 col-lg-9" style="padding: 0;">
                                    <input class="form-control" name="name" placeholder="商品搜索"
                                           th:value="${searchMap.get('name')}"
                                           type="text">
                                </div>
                                <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3" style="text-align: center;">
                                    <button type="submit" class="btn btn-default"
                                            style="font-size: small;">搜&nbsp;&nbsp;索
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- 商品分类栏 -->
            <div class="row goodCount">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <span>全部结果:</span>
                    <span th:text="${result.pageInfo.totalElements}">9999件</span>
                    <span>&nbsp;/&nbsp;</span>
                    <span th:each="searchEntry:${searchMap}">
                        <span th:unless="${searchEntry.value eq ''} or ${searchEntry.key eq 'page'}or ${searchEntry.key eq 'name'}">
                            <span class="chosedItem" th:text="${searchEntry.value}">手机</span>
                            <a th:href="${#strings.replace(url,searchEntry.key+'='+searchEntry.value,searchEntry.key+'=')}">x</a>
                            <i>、</i>
                        </span>
                  </span>
                </div>
            </div>
            <div id="specChoseDiv">
                <div class="row Item" th:if="(${#maps.containsKey(result,'brandList')})">
                    <div class="col-xs-3 col-sm-3 col-md-2 col-lg-1 titleDiv">
                        <span class="title">品牌</span>
                    </div>
                    <div class="col-xs-9 col-sm-9 col-md-10 col-lg-11 ">
                        <div class="row specItem">
                            <ul class="logo-list" style="margin-left: 10px;"
                                th:each="brand,brandStat:${result.brandList}">
                                <li style="overflow: hidden" th:if="${brandStat.count<25}">
                                    <a th:href="@{${url}(brand=${brand})}" th:text="${brand}">小米</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="row Item" th:if="${#maps.containsKey(result,'FirCategoryList')}">
                    <div class="col-xs-3 col-sm-3 col-md-2 col-lg-1 titleDiv">
                        <span class="title">一级分类</span>
                    </div>
                    <div class="col-xs-9 col-sm-9 col-md-10 col-lg-11 cateList">
                        <div class="row">
                            <span th:each="category:${result.FirCategoryList}">
                                <span>
                                    <a th:href="@{${url}(FirCategory=${category})}"
                                       th:text="${#strings.abbreviate(category,10)}">华为</a>
                                    <i>、</i>
                                </span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="row Item" th:if="${#maps.containsKey(result,'SeCategoryList')} ">
                    <div class="col-xs-3 col-sm-3 col-md-2 col-lg-1 titleDiv">
                        <span class="title">二级分类</span>
                    </div>
                    <div class="col-xs-9 col-sm-9 col-md-10 col-lg-11 cateList">
                        <div class="row">
                            <span th:each="category:${result.SeCategoryList}">
                                <span>
                                    <a th:href="@{${url}(SeCategory=${category})}"
                                       th:text="${#strings.abbreviate(category,10)}">华为</a>
                                    <i>、</i>
                                </span>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="row Item" th:if="${#maps.containsKey(result,'ThCategoryList')}">
                    <div class="col-xs-3 col-sm-3 col-md-2 col-lg-1 titleDiv">
                        <span class="title">三级分类</span>
                    </div>
                    <div class="col-xs-9 col-sm-9 col-md-10 col-lg-11 cateList">
                        <div class="row">
                            <span th:each="category:${result.ThCategoryList}">
                                <span>
                                    <a th:href="@{${url}(ThCategory=${category})}"
                                       th:text="${#strings.abbreviate(category,10)}">华为</a>
                                    <i>、</i>
                                </span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 结束分类栏 -->
            <!-- 商品栏 -->
            <div class="goods row" style="margin-top: 10px;">
                <!-- 单个商品 -->
                <div class="col-sm-4 col-md-3 col-lg-3 col-xs-6" th:each="spu:${result.spuList}">
                    <div class="thumbnail">
                        <img alt="..." src="images/loader/loading.gif" th:src="${spu.image}">
                        <div class="caption">
                            <h5 th:text="${#strings.abbreviate(spu.name,23)}">Thumbnail label</h5>
                            <!--                            <p th:text="${#strings.abbreviate(#strings.replace(spu.category1Name,'null','')+' '+#strings.replace(spu.category2Name,'null','')+' '+#strings.replace(spu.category3Name,'null','')+' '+spu.name,50)}">-->
                            <!--                                ...</p>-->
                            <p th:text="${#strings.abbreviate(spu.name,50)}"></p>
                            <p>
                            <div>
                                <span style="display: block;text-align: center">
                                    <a class="btn btn-primary" th:onclick="|getSpuInfo(${spu.id})|"
                                       role="button">
                                    <i class="fa fa-shopping-cart"></i>&nbsp;&nbsp;购买</a>
                                </span>
                            </div>
                            </p>
                        </div>
                    </div>
                </div>
                <!-- 单个商品 -->
            </div>
            <!-- 结束商品栏 -->
            <!-- 分页栏 -->
            <div style="text-align: center; " id="pageDiv">
                <nav aria-label="Page navigation">
                    <ul class="pagination pagination-lg">
                        <li th:if="${result.pageInfo.page-1}>=0">
                            <a aria-label="Previous"
                               th:href="@{${#strings.replace(url,'page='+searchMap.page,'')}(page=${result.pageInfo.page-1})}">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <li>
                            <a th:href="${#maps.containsKey(searchMap,'page')} ?
                                                                ${#strings.replace(url,'page='+searchMap.page,'page='+(result.pageInfo.page-4))}:
                                                                @{${url}(page=${result.pageInfo.page-4})}"
                               th:if="(${result.pageInfo.page-4}>=0) and (${result.pageInfo.page+3}>${result.pageInfo.totalPage})"
                               th:text="${result.pageInfo.page-4+1}">
                                1</a>
                        </li>
                        <li>
                            <a th:href="${#maps.containsKey(searchMap,'page')} ?
                                                                ${#strings.replace(url,'page='+searchMap.page,'page='+(result.pageInfo.page-3))}:
                                                                @{${url}(page=${result.pageInfo.page-3})}"
                               th:if="(${result.pageInfo.page-3}>=0) and (${result.pageInfo.page+2}>${result.pageInfo.totalPage})"
                               th:text="${result.pageInfo.page-3+1}">
                                1</a>
                        </li>
                        <li>
                            <a th:href="${#maps.containsKey(searchMap,'page')} ?
                                                                ${#strings.replace(url,'page='+searchMap.page,'page='+(result.pageInfo.page-2))}:
                                                                @{${url}(page=${result.pageInfo.page-2})}"
                               th:if="${result.pageInfo.page-2}>=0"
                               th:text="${result.pageInfo.page-2+1}">1</a></li>
                        <li>
                            <a th:href="${#maps.containsKey(searchMap,'page')} ?
                                                                ${#strings.replace(url,'page='+searchMap.page,'page='+(result.pageInfo.page-1))}:
                                                                @{${url}(page=${result.pageInfo.page-1})}"
                               th:if="${result.pageInfo.page-1}>=0"
                               th:text="${result.pageInfo.page-1+1}">2</a></li>
                        <li><span style="color: black;"
                                  th:text="${result.pageInfo.page+1}">3</span></li>
                        <li>
                            <a th:href="${#maps.containsKey(searchMap,'page')} ?
                                                                ${#strings.replace(url,'page='+searchMap.page,'page='+(result.pageInfo.page+1))}:
                                                                @{${url}(page=${result.pageInfo.page+1})}"
                               th:if="${result.pageInfo.page+1}<${result.pageInfo.totalPage}"
                               th:text="${result.pageInfo.page+1+1}">4</a>

                        </li>
                        <li>
                            <a th:href="${#maps.containsKey(searchMap,'page')} ?
                                                                 ${#strings.replace(url,'page='+searchMap.page,'page='+(result.pageInfo.page+2))}:
                                                                @{${url}(page=${result.pageInfo.page+2})}"
                               th:if="${result.pageInfo.page+2}<${result.pageInfo.totalPage}"
                               th:text="${result.pageInfo.page+2+1}">5</a>
                        </li>
                        <li>
                            <a th:href="${#maps.containsKey(searchMap,'page')} ?
                                                                ${#strings.replace(url,'page='+searchMap.page,'page='+(result.pageInfo.page+3))}:
                                                                @{${url}(page=${result.pageInfo.page+3})}"
                               th:if="${result.pageInfo.page-1}<0 and ${result.pageInfo.page+3}<=${result.pageInfo.totalPage}"
                               th:text="${result.pageInfo.page+3+1}">1</a>
                        </li>
                        <li>
                            <a th:href="${#maps.containsKey(searchMap,'page')} ?
                                                                ${#strings.replace(url,'page='+searchMap.page,'page='+(result.pageInfo.page+4))}:
                                                                @{${url}(page=${result.pageInfo.page+4})}"
                               th:if="${result.pageInfo.page-3}<0  and ${result.pageInfo.page+4}<=${result.pageInfo.totalPage}"
                               th:text="${result.pageInfo.page+4+1}">2</a>
                        </li>
                        <li th:if="${result.pageInfo.page+1}<${result.pageInfo.totalPage}">
                            <a aria-label="Next"
                               th:href="${#maps.containsKey(searchMap,'page')} ?
                                                                ${#strings.replace(url,'page='+searchMap.page,'page='+(result.pageInfo.page+1))}:
                                                                @{${url}(page=${result.pageInfo.page+1})}">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                        <span style="line-height: 30px; margin-top: 6px;margin-left: 10px;">总共&nbsp;
                            <span style="font-size: large;" th:text="${result.pageInfo.totalPage}">10</span>&nbsp;页
                        </span>&nbsp;/&nbsp;
                        <span style="line-height: 30px;">去到
                            <span>
                                <input id="gotoPageNo"
                                       style="width: 30px;height: 20px;text-align: center;border: 0px ;border-bottom: 1px solid black;"
                                       type="text">
                            </span>页
                            <button id="toPageBtn" style="border: none;background-color: rgba(240, 248, 255, 0);"
                                    type="button">跳转</button>
                        </span>
                    </ul>
                </nav>
            </div>
            <!-- 结束分页栏 -->
        </div>
    </div>
</div>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>
<script th:src="@{js/myUtil.js}"></script>
<script>
    $(".buyNumInput").val("1");
    $(".buyNumPlus").click(function () {
        var buyNumInput = $(".buyNumInput").val();
        buyNumInput++;
        $(".buyNumInput").val(buyNumInput)
    });
    $(".buyNumDes").click(function () {
        var buyNumInput = $(".buyNumInput").val();
        if (buyNumInput > 1) {
            buyNumInput -= 1;
            $(".buyNumInput").val(buyNumInput);
        }
    });
    $(".closeGoodDetail").click(function () {
        $("#price").html("--")
        $("#skuImg").attr("src","images/loader/loading.gif");
        $(".goodDetail").animate({
            bottom: "-600px"
        });
    });

    var specCount = 0;
    var chosedSpuID = 0;
    var chosedSkuID = 0;

    $("#myOrders").click(function (){
        window.location.href="order.html"
    })

    function getSpuInfo(spuID) {
        chosedSpuID = spuID;
        $.ajax({
            type: "get", //提交的方法
            url: "/frontApi/skuSearch", //提交的地址
            data: {
                "spuID": spuID
            }, // 序列化表单值
            async: false,
            dataType: "json",
            crossDomain: true,
            error: function (request) { //失败的话
                alert("获取商品信息失败，请稍后重试");
            },
            success: function (data) { //成功
                if (data.statusCode != 200) {
                    pormptBox(2000, data.desc);
                } else {
                    var rowDataHtml = "";
                    specCount = 0;
                    for (var specName in data.result.specList) {
                        specCount++;
                        rowDataHtml += `<div class="goodDetailSpecTitle" paramTitle="` + specName + `">` + specName
                        for (var j = 0; j < data.result.specList[specName].length; j++) {
                            rowDataHtml += `<div class="goodDetailSpecItem">
                                          <span><i paramValue="` + data.result.specList[specName][j] + `">` + data.result.specList[specName][j] + `</i></span>
                                       </div>`
                        }
                        rowDataHtml += `</div>`
                    }
                    $(".goodDetailSpec").html(rowDataHtml)
                }
                bandParamClick();
                $(".goodDetail").animate({
                    bottom: "0px"
                });
            }
        });
    }

    //参数绑定点击事件
    function bandParamClick(){
        $(".goodDetailSpecItem span").click(function () {
            $(this).parent().addClass("choseItem");
            $(this).parent().prevAll().removeClass("choseItem");
            $(this).parent().nextAll().removeClass("choseItem");
            $(this).parent().nextAll().removeClass("choseItem");
            $(this).parent().parent().nextAll().removeClass("choseItem");
            $("#price").html("--");
            if ($(".choseItem").length==specCount){
                getSkuPrice();
            }
        });
    }
    bandParamClick();

    //点击现在购买
    function getSkuPrice() {
        var params = {};
        params["spuID"] = chosedSpuID;
        for (var i = 0; i < specCount; i++) {
            key = $(".goodDetailSpecTitle:eq(" + i + ")").attr("paramTitle");
            value = $(".choseItem:eq(" + i + ") span i").attr("paramValue");
            params["spec_" + key] = value;
        }
        $.ajax({
            type: "get", //提交的方法
            url: "/frontApi/skuSearch", //提交的地址
            data: params, // 序列化表单值
            async: false,
            dataType: "json",
            crossDomain: true,
            error: function (request) { //失败的话
                alert("获取商品价格失败，请稍后重试");
            },
            success: function (data) { //成功
                chosedSkuID = data.result.skuList[0].id;
                $("#price").html(data.result.skuList[0].price);
                $("#skuImg").attr("src",data.result.skuList[0].image);
            }
        });
    }

    var userID = getCookie("userID");
    $("#buyNow").click(function (){
        alert(chosedSkuID);
        $.ajax({
            type: "post", //提交的方法
            url: "/frontApi/order", //提交的地址
            data: JSON.stringify({
                "userID":userID,
                "skuID":chosedSkuID
            }), // 序列化表单值
            async: true,
            contentType: "application/json;charset=UTF-8",
            error: function (request) { //失败的话
                alert(JSON.stringify(request))
            },
            success: function (data) { //成功
                alert(JSON.stringify(data))
            }
        });
    })
</script>
</body>

</html>